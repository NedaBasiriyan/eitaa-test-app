<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø¨Ø±Ù†Ø§Ù…Ú© - ØªØ³Øª Ø¹Ø¶ÙˆÛŒØª</title>
<style>
  body{font-family: Tahoma, Arial, sans-serif; background: linear-gradient(180deg,#e0f7fa,#b2ebf2); color:#013b34; margin:0; padding:20px;}
  .card{max-width:760px;margin:30px auto;background:white;border-radius:12px;padding:22px;box-shadow:0 8px 30px rgba(0,0,0,0.08)}
  header{display:flex;gap:14px;align-items:center}
  header img{width:72px;height:72px;border-radius:10px;object-fit:cover}
  h1{margin:0;font-size:22px;color:#006064}
  p.lead{color:#004d40;margin-top:8px}
  .channels{margin:18px 0;padding:12px;background:#e0f2f1;border-radius:8px}
  button{background:#00796b;color:#fff;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-size:16px}
  .danger{background:#d32f2f}
  .msg{margin-top:14px;padding:12px;border-radius:8px;background:#e8f5e9;color:#1b5e20}
  footer{margin-top:18px;font-size:13px;color:#00695c}
</style>
</head>
<body>
  <div class="card">
    <header>
      <img src="assets/header.jpg" alt="Ù‡Ø¯Ø± Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ" />
      <div>
        <h1>Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø¨Ø±Ù†Ø§Ù…Ú©</h1>
        <p class="lead">Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Ø¨Ø±Ù†Ø§Ù…Ú© Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ğŸŒ¸ Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯.</p>
      </div>
    </header>

    <div class="channels">
      <strong>Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ø¶ÙˆÛŒØª:</strong>
      <ul id="channelList"></ul>
    </div>

    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <button id="checkBtn">Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª ÙˆØ§Ù‚Ø¹ÛŒ</button>
      <button class="danger" id="refreshBtn">Ù…Ù† Ù‡Ù†ÙˆØ² Ø¹Ø¶Ùˆ Ù†Ø´Ø¯Ù…</button>
    </div>

    <div id="result" class="msg" style="display:none"></div>

    <footer>
      <small>Ù†Ø³Ø®Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ â€” Ù…ØªÙ† ØªØ³ØªÛŒ. Ø¨Ø¹Ø¯ Ø§Ø² ØªØ§ÛŒÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…ØªÙ† Ùˆ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯.</small>
    </footer>
  </div>

<script>
const config = {
  channels: ["@hamserr"]
};

const channelListEl = document.getElementById('channelList');
config.channels.forEach(ch => {
  const li = document.createElement('li');
  li.textContent = ch;
  channelListEl.appendChild(li);
});

function getUserIdFromPlatform() {
  try {
    if(window.Eitaa && window.Eitaa.WebApp && window.Eitaa.WebApp.initDataUnsafe && window.Eitaa.WebApp.initDataUnsafe.user) {
      return window.Eitaa.WebApp.initDataUnsafe.user.id;
    }
    if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
      return window.Telegram.WebApp.initDataUnsafe.user.id;
    }
  } catch(e){}
  const fallback = prompt("Ø¨Ø±Ø§ÛŒ ØªØ³Øª: Ù„Ø·ÙØ§Ù‹ user_id (Ø¹Ø¯Ø¯) Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹ 123456789):");
  return fallback ? parseInt(fallback) : null;
}

document.getElementById('checkBtn').addEventListener('click', async () => {
  const userId = getUserIdFromPlatform();
  if(!userId) {
    showResult('Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ ØªØ³Øª ÛŒÚ© Ø¹Ø¯Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', true);
    return;
  }
  showResult('Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª ... Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯');
  try {
    const resp = await fetch('/api/check-membership', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ user_id: userId, channels: config.channels })
    });
    const data = await resp.json();
    if(resp.ok) {
      if(data.all_members) {
        showResult('ØªØ¨Ø±ÛŒÚ©! Ù‡Ù…Ù‡ Ø¹Ø¶ÙˆÛŒØª Ù‡Ø§ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯ âœ…');
      } else {
        showResult('Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ù…Ù„ Ù†ÛŒØ³Øª: ' + data.missing.join(', '), true);
      }
    } else {
      showResult('Ø®Ø·Ø§: ' + (data.error || 'Ù…Ø´Ú©Ù„ Ø¯Ø± Ø³Ø±ÙˆØ±'), true);
    }
  } catch(e) {
    showResult('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±: ' + e.message, true);
  }
});

document.getElementById('refreshBtn').addEventListener('click', () => {
  showResult('Ø§Ú¯Ø± Ø¹Ø¶Ùˆ Ø´Ø¯ÛŒØ¯ØŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø¹Ø¶ÙˆÛŒØª Ø¯Ú©Ù…Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.');
});

function showResult(msg, isError=false){
  const el = document.getElementById('result');
  el.style.display = 'block';
  el.style.background = isError ? '#ffebee' : '#e8f5e9';
  el.style.color = isError ? '#b71c1c' : '#1b5e20';
  el.textContent = msg;
}
</script>
</body>
</html>
